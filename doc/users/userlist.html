<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>数据表格</title>
    <link rel="stylesheet" href="../../easyui/themes/icon.css">
    <link rel="stylesheet" href="../../easyui/themes/default/easyui.css">
    <link rel="stylesheet" href="../../css/base.css">
</head>

<body>
<table id="users" class="easyui-datagrid" style="height:550px"  
        data-options="url:'business/user.php?action=getUsers',toolbar:tools,title:'用户信息列表',iconCls:'icon-tag',method:'get'">  
    <thead>  
        <tr>  
            <th data-options="field:'11',checkbox:true,width:40">选择</th>  
            <th data-options="field:'username',width:100">用户名</th>  
            <th data-options="field:'truename',width:100">姓名</th>  
            <th data-options="field:'registerTime',width:100,align:'right'">注册日期</th>  
            <th data-options="field:'op',width:70,align:'center',formatter:adminGoods">管理</th>  
        </tr>  
    </thead>  
</table> 

<div id="win" class="easyui-window" title="编辑用户信息" style="width:300px;height:250px"  
        data-options="iconCls:'icon-useredit',modal:true,collapsible:false,closed:true">  
     <div>用户名:<input type="text" id="username" /></div>
     <div>姓名:<input type="text" id="truename" /></div>
     <div>注册日期:<input type="text" id="registerTime" /></div>
   
</div>

<script src="../../easyui/jquery.min.js"></script>
<script src="../../easyui/jquery.easyui.min.js"></script>
<script src="../../easyui/common.js"></script>

<script type="text/javascript">

var tools=[{
		iconCls: 'icon-edit',
		text:'编辑用户信息',
		handler: function(){alert('edit')}
	},{
		iconCls: 'icon-help',
		text:'帮助',
		handler: function(){alert('help')}
	}];
	
function adminGoods(value,row,index)
{
	return "<img onclick='editUser("+index+")' src='images/useredit.gif' style='margin-top:5px; cursor:pointer;' />&nbsp;&nbsp;<img onclick='deleteUser("+index+")' src='images/userdelete.gif'  style='margin-top:5px; cursor:pointer;' />"
}

function deleteUser(index)
{
	//如何获得需要被删除的用户名
	//取消所有行的选中状态
	$("#users").datagrid("unselectAll");
	//根据index选中行
	$("#users").datagrid("selectRow",index);
	var row=$("#users").datagrid("getSelected"); //json格式的对象
	var username=row.username;
	$.messager.confirm("删除确认","您真的确认需要删除【"+row.truename+"】的账户信息吗？",function(r){
		   if(r==true)
		   {
			   $.ajax({
				type:"POST",
				async:true,
				dataType:"text",
				data:{username:username},
				url:"business/user.php?action=deleteUser",
				success: function(msg){
					   if(msg=="1")
					   {
						  window.location.reload(true);
					   }
					   else
					   {
						   $.messager.alert("错误提示","删除失败！","error");
					   }
					}
				});
		   }
		});
}


function editUser(index)
{
	$("#win").window({closed:false});
	//取消所有行的选中状态
	$("#users").datagrid("unselectAll");
	//根据index选中行
	$("#users").datagrid("selectRow",index);
	var row=$("#users").datagrid("getSelected"); //json格式的对象
	$("#username").val(row.username);
	$("#truename").val(row.truename);
	$("#registerTime").val(row.registerTime);
}


</script>
</body>
</html>
